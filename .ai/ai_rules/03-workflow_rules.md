# AI 工作流协作规范 (SoT/EP/Code)

## 1. 核心工作流遵循
当前项目采用“源文档 (SoT) -> 执行包 (EP) -> 代码 (Code)”的三层模型。AI 的行为必须严格遵守该模型的流转机制（参见 `.ai/AI_WORKFLOW.md`）。

## 2. 源文档 (SoT) 交互规则
- **不可随意篡改**：源文档（包含目标、需求、架构、规范等）代表项目的权威上下文。在开发（执行 EP）的具体过程中，AI 不能直接修改源文档。
- **反哺机制**：当 EP 执行完毕并得到验证后，AI 必须将执行过程中发现的语义冲突、术语变更、边界调整或 ADR（架构决策记录），统一通过反哺流程写入并更新到源文档。
- **熵增治理职责**：AI 需主导源文档的收敛与清理。当发现重复、过期或语义冲突的条目时，应提出修改建议：证据收集 -> 结论生成 -> 文档更新与收敛。高认知成本的操作交由人工审批，其余常规清理可由 AI 自动执行。

## 3. 执行包 (EP) 交互规则
- **任务冻结与专注**：EP 是上下文的冻结快照。AI 必须根据 EP 中定义的步骤清单（`steps.md`）严格执行，且在当前执行包上下文内收敛，不能偏离当前任务目标。
- **垂直切片优先**：鼓励以垂直切片（Vertical Slice）的方式进行开发，挑选最短的可验收路径，尽早验证初步结果，防止需求漂移。
- **测试与验证驱动**：必须将需求阶段的 DoD（完成定义）转化为具体的测试用例清单与验证脚本。在修改代码的同时，确保变更可测试、可验证。如果执行失败，需总结经验，并在反哺后重新生成新 EP。

## 4. 代码 (Code) 交互规则
- **边界清晰**：遵循项目中所有的代码层规范（见 `02-code_guidelines.md` 与 `.ai/specs/engineering/` 下的约定）。
- **证据交付**：变更必须是可运行、可测试、有证据支撑的。自动化测试代码属于代码层，AI 必须生成相关的验证机制证明 DoD 的达成。